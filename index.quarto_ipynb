{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"Selection Bias & Missing Data Challenge\"\n",
        "subtitle: \"Creating a Statistics Meme: Write Your Own Functions\"\n",
        "format:\n",
        "  html: default\n",
        "execute:\n",
        "  echo: false\n",
        "  eval: true\n",
        "---\n",
        "\n",
        "# ðŸŽ¨ Selection Bias & Missing Data Challenge\n",
        "\n",
        "::: {.callout-important}\n",
        "## ðŸ“Š Challenge Overview\n",
        "\n",
        "**Your Task:** Create a four-panel statistics meme demonstrating selection bias. You'll write three Python functions yourself to complete the workflow, then assemble them into a professional meme.\n",
        "\n",
        "**Deliverables:**\n",
        "\n",
        "1. Three Python functions you write yourself:\n",
        "   - `step4_create_block_letter.py` - Create a block letter \"S\" matching image dimensions\n",
        "   - `step5_create_masked.py` - Apply the letter mask to the stippled image\n",
        "   - `create_meme.py` - Assemble all components into the four-panel meme\n",
        "2. A complete `index.qmd` file that uses all functions to generate your meme\n",
        "3. Your final statistics meme (as a PNG file) using your own image\n",
        "\n",
        "**Key Learning:** This challenge teaches you to write modular Python functions and assemble them into a complete workflow. You'll learn to structure code professionally and create a memorable visual representation of selection bias.\n",
        "\n",
        "**Repository Information:**\n",
        "\n",
        "- **Source/Starter File:** Available in the main repository at [https://github.com/flyaflya/selectionBiasChallenge](https://github.com/flyaflya/selectionBiasChallenge)\n",
        "- **Challenge Read Online:** View the challenge instructions at [https://flyaflya.github.io/selectionBiasChallenge](https://flyaflya.github.io/selectionBiasChallenge)\n",
        "- **Your Submission:** Fork this challenge and create your GitHub Pages site at `https://[your-username].github.io/selectionBiasChallenge/`\n",
        ":::\n",
        "\n",
        "## The Problem: Visualizing Selection Bias\n",
        "\n",
        "Selection bias occurs when observed data isn't representative of the population. Your meme will demonstrate this concept through visual metaphor:\n",
        "\n",
        "- **Reality**: Your original image represents the true population\n",
        "- **Your Model**: Your stippled image represents your data collection (sampling)\n",
        "- **Selection Bias**: A bold letter \"S\" represents a systematic pattern of missing data\n",
        "- **Estimate**: Stippled image with \"S\" mask applied shows the biased estimateâ€”what you see when selection bias removes data points in a systematic pattern\n",
        "\n",
        "**Key Concept:** Images are simply matricesâ€”2D arrays where each value represents a pixel (0.0 = black, 1.0 = white). Your stippled image is a matrix with black dots (data points) on a white background. Selection bias removes some of these pixels (data points) in a systematic pattern (the \"S\"), creating a biased estimate.\n",
        "\n",
        "**Key Insight:** When data is missing in a systematic pattern (not random), your estimates become biased. The \"S\" shape makes it visually obvious that the missing data follows a pattern, just like real selection bias in statistics.\n",
        "\n",
        "## Step 1: Prepare Image\n",
        "\n",
        "Load an image, convert to grayscale, and resize to appropriate dimensions while maintaining aspect ratio."
      ],
      "id": "a07e0c74"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: step1-prepare\n",
        "#| echo: false\n",
        "#| fig-cap: Original image prepared for processing\n",
        "\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "from step1_prepare_image import prepare_image\n",
        "\n",
        "# Load and prepare the image\n",
        "# CHANGE THIS to use your own image!\n",
        "img_path = 'rohith.jpg'  # Example image - replace with your own image\n",
        "gray_image = prepare_image(img_path, max_size=512)\n",
        "\n",
        "# Display the prepared image\n",
        "fig, ax = plt.subplots(figsize=(6.5, 5))\n",
        "ax.imshow(gray_image, cmap='gray', vmin=0, vmax=1)\n",
        "ax.axis('off')\n",
        "ax.set_title('Step 1: Prepared Image', fontsize=14, fontweight='bold', pad=10)\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "step1-prepare",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Step 2: Create Stippled Image\n",
        "\n",
        "Generate a blue noise stippling pattern from the prepared image. This creates a pattern of dots that preserves visual information while maintaining good spatial distribution."
      ],
      "id": "8d4390f6"
    },
    {
      "cell_type": "code",
      "metadata": {
        "message": false
      },
      "source": [
        "#| label: step2-stipple\n",
        "#| echo: false\n",
        "#| fig-cap: Blue noise stippling pattern\n",
        "#| warning: false\n",
        "\n",
        "from step2_create_stipple import create_stipple\n",
        "\n",
        "# Create stippled image\n",
        "stipple_pattern, samples = create_stipple(\n",
        "    gray_image,\n",
        "    percentage=0.08,  # 8% of pixels will be stippled\n",
        "    sigma=0.9,  # Repulsion radius\n",
        "    content_bias=0.9,  # Strongly follow importance map\n",
        "    noise_scale_factor=0.1,  # Moderate exploration\n",
        "    extreme_downweight=0.5,  # Moderate downweighting of extremes\n",
        "    extreme_threshold_low=0.2,  # Downweight tones below 0.2\n",
        "    extreme_threshold_high=0.8,  # Downweight tones above 0.8\n",
        "    extreme_sigma=0.1  # Smooth transition width\n",
        ")\n",
        "\n",
        "# Display the stippled image\n",
        "fig, ax = plt.subplots(figsize=(6.5, 5))\n",
        "ax.imshow(stipple_pattern, cmap='gray', vmin=0, vmax=1)\n",
        "ax.axis('off')\n",
        "ax.set_title('Step 2: Stippled Image', fontsize=14, fontweight='bold', pad=10)\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "step2-stipple",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Step 3: Create Tonal Analysis (Optional Refinement Step)\n",
        "\n",
        "Create a tonal analysis by dividing the image into a grid and computing average brightness in each section. This visualizes the distribution of tones and helps identify which brightness ranges are most important."
      ],
      "id": "40008f08"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: step3-tonal\n",
        "#| echo: false\n",
        "#| fig-cap: Box-averaged tonal analysis showing brightness distribution\n",
        "\n",
        "from step3_create_tonal import create_tonal\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# Create tonal analysis with a 16Ã—12 grid\n",
        "grid_rows = 16\n",
        "grid_cols = 12\n",
        "tonal_image, average_tones, tonal_stats = create_tonal(\n",
        "    gray_image,\n",
        "    grid_rows=grid_rows,\n",
        "    grid_cols=grid_cols,\n",
        "    return_full_image=True\n",
        ")\n",
        "\n",
        "# Display the box-averaged tonal image with text annotations\n",
        "fig, ax = plt.subplots(figsize=(6.5, 5))\n",
        "\n",
        "# Show box-averaged tonal image\n",
        "ax.imshow(tonal_image, cmap='gray', vmin=0, vmax=1)\n",
        "ax.axis('off')\n",
        "ax.set_title('Step 3: Box-Averaged Tonal Analysis', fontsize=14, fontweight='bold', pad=10)\n",
        "\n",
        "# Calculate grid cell dimensions for text placement\n",
        "h, w = gray_image.shape\n",
        "section_h = h / grid_rows\n",
        "section_w = w / grid_cols\n",
        "\n",
        "# Add text annotations showing tone values (2 decimals) at the center of each grid cell\n",
        "for i in range(grid_rows):\n",
        "    for j in range(grid_cols):\n",
        "        tone = average_tones[i, j]\n",
        "        # Calculate center position of the grid cell\n",
        "        y_center = (i + 0.5) * section_h\n",
        "        x_center = (j + 0.5) * section_w\n",
        "        # Use white text for dark sections, black text for light sections\n",
        "        text_color = 'white' if tone < 0.5 else 'black'\n",
        "        ax.text(x_center, y_center, f'{tone:.2f}', \n",
        "                ha='center', va='center', \n",
        "                color=text_color, fontsize=6, fontweight='bold')\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()\n",
        "\n",
        "# Print key statistics for parameter tuning\n",
        "print(f\"\\nðŸ“Š Tonal Statistics for Parameter Tuning:\")\n",
        "print(f\"  Mean brightness: {tonal_stats['mean']:.3f}\")\n",
        "print(f\"  Standard deviation: {tonal_stats['std']:.3f}\")\n",
        "print(f\"  Brightness range: [{tonal_stats['min']:.3f}, {tonal_stats['max']:.3f}]\")"
      ],
      "id": "step3-tonal",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Step 4: Create Block Letter \"S\" \n",
        "block letter \"S\" is created using the create_block_letter_s function."
      ],
      "id": "dcf45366"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: step4-block-letter\n",
        "#| echo: false\n",
        "#| fig-cap: Block letter S representing selection bias\n",
        "\n",
        "from step4_create_block_letter import create_block_letter_s\n",
        "\n",
        "# Get image dimensions\n",
        "h, w = gray_image.shape\n",
        "\n",
        "# Create block letter S\n",
        "block_letter = create_block_letter_s(h, w, letter=\"S\", font_size_ratio=0.9)\n",
        "\n",
        "# Display the block letter\n",
        "fig, ax = plt.subplots(figsize=(6.5, 5))\n",
        "ax.imshow(block_letter, cmap='gray', vmin=0, vmax=1)\n",
        "ax.axis('off')\n",
        "ax.set_title('Step 4: Selection Bias (Block Letter S)', fontsize=14, fontweight='bold', pad=10)\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "step4-block-letter",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Step 5: Create Masked Image \n",
        "Block letter mask is applied on the stippled image."
      ],
      "id": "d23d4eba"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: step5-masked\n",
        "#| echo: false\n",
        "#| fig-cap: Masked stippled image showing selection bias effect\n",
        "\n",
        "from step5_create_masked import create_masked_stipple\n",
        "\n",
        "# Create masked stippled image\n",
        "masked_stipple = create_masked_stipple(\n",
        "    stipple_pattern,\n",
        "    block_letter,\n",
        "    threshold=0.5  # Pixels below 0.5 are considered part of the mask\n",
        ")\n",
        "\n",
        "# Display the masked image\n",
        "fig, ax = plt.subplots(figsize=(6.5, 5))\n",
        "ax.imshow(masked_stipple, cmap='gray', vmin=0, vmax=1)\n",
        "ax.axis('off')\n",
        "ax.set_title('Step 5: Masked Stippled Image (Estimate)', fontsize=14, fontweight='bold', pad=10)\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "step5-masked",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Create the Final Statistics Meme "
      ],
      "id": "cb2d3ec1"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: create-final-meme\n",
        "#| echo: false\n",
        "\n",
        "from create_meme import create_statistics_meme\n",
        "\n",
        "# Create the final meme\n",
        "create_statistics_meme(\n",
        "    original_img=gray_image,\n",
        "    stipple_img=stipple_pattern,\n",
        "    block_letter_img=block_letter,\n",
        "    masked_stipple_img=masked_stipple,\n",
        "    output_path=\"statistics_meme.png\",\n",
        "    dpi=150,\n",
        "    background_color=\"lightgray\"  # or \"pink\", \"lightgray\", etc.\n",
        ")"
      ],
      "id": "create-final-meme",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Final Statistics Meme\n",
        "\n",
        "Here's my completed statistics meme demonstrating selection bias:"
      ],
      "id": "0c8f55ff"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: final-meme\n",
        "#| echo: false\n",
        "#| fig-cap: Statistics meme demonstrating selection bias\n",
        "\n",
        "# Display the final meme\n",
        "from IPython.display import Image, display\n",
        "display(Image(\"statistics_meme.png\"))"
      ],
      "id": "final-meme",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### Explanation\n",
        "\n",
        " - This meme demonstrates selection bias by showing how selectively keeping only certain stipple points distorts our understanding of the original image. The Reality panel reflects the true population, while the stippled image (Model) represents the full dataset we collect. When the selection bias removes all data except the points inside the â€œS,â€ the resulting Estimate becomes systematically distorted and no longer represents the true population â€” just like biased sampling in real studies leads to incorrect conclusions."
      ],
      "id": "eca1f1a2"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3",
      "path": "C:\\Users\\bhavy\\AppData\\Roaming\\jupyter\\kernels\\python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}